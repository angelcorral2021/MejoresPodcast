---
import PodcastCard from '../PodcastCard.astro';
import { getLatestPodcasts } from '../../data/podcasts';
import { getPodcastLikes } from '../../utils/likes';

interface Props {
  limit?: number;
}

const { limit = 6 } = Astro.props;

// Últimos capítulos (con likes integrados)
const latestPodcasts = getLatestPodcasts(limit).map(podcast => ({
  ...podcast,
  likes: getPodcastLikes(podcast.id) || podcast.likes || 0
}));
---

<section class="section" id="latest-section">
  <div class="section-header">
    <div class="section-title-wrapper">
      <h2 class="section-title">
        <svg class="section-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
        Últimos Capítulos
      </h2>
      <p class="section-subtitle">Los episodios más recientes de cualquier género</p>
    </div>
  </div>
  <div class="carousel-container">
    <button class="carousel-button prev" aria-label="Episodios anteriores">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
      </svg>
    </button>
    
    <div class="carousel-track">
      <div class="carousel-slides" data-total-slides={latestPodcasts.length}>
        {latestPodcasts.map((podcast) => (
          <div class="carousel-slide">
            <PodcastCard podcast={podcast} />
          </div>
        ))}
      </div>
    </div>
    
    <button class="carousel-button next" aria-label="Siguientes episodios">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
      </svg>
    </button>
  </div>

  <div class="carousel-dots">
    {Array.from({ length: Math.ceil(latestPodcasts.length / 3) }).map((_, i) => (
      <button 
        class="carousel-dot" 
        data-slide={i}
        aria-label={`Ir a página ${i + 1} de episodios`}
      ></button>
    ))}
  </div>
</section>

<style>
  .section {
    @apply scroll-mt-8;
  }

  .section-header {
    @apply flex items-end justify-between mb-4 flex-wrap gap-4;
  }

  .section-title-wrapper {
    @apply flex-1;
  }

  .section-title {
    @apply flex items-center gap-2 text-2xl md:text-3xl font-bold text-gray-900 dark:text-white mb-1;
  }

  .section-icon {
    @apply w-6 h-6 text-purple-600 dark:text-purple-400;
  }

  .section-subtitle {
    @apply text-base text-gray-600 dark:text-gray-400;
  }

  .carousel-container {
    @apply relative flex items-center gap-4 mb-4;
  }

  .carousel-button {
    @apply flex-shrink-0 w-10 h-10 flex items-center justify-center rounded-full bg-white dark:bg-gray-800 shadow-md hover:shadow-lg transition-all duration-200;
    @apply text-purple-600 dark:text-purple-400 hover:text-purple-700 dark:hover:text-purple-300;
    @apply border border-purple-200 dark:border-purple-800 hover:border-purple-400 dark:hover:border-purple-600;
    @apply focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 dark:focus:ring-offset-gray-900;
    @apply disabled:opacity-50 disabled:cursor-not-allowed;
  }

  .carousel-track {
    @apply relative flex-1 overflow-hidden;
  }

  .carousel-slides {
    @apply flex gap-4 transition-transform duration-700 ease-in-out;
  }

  .carousel-slide {
    @apply flex-shrink-0 w-full sm:w-[calc(50%-0.5rem)] lg:w-[calc(33.333%-0.75rem)];
  }

  .carousel-dots {
    @apply flex justify-center gap-2;
  }

  .carousel-dot {
    @apply w-2 h-2 rounded-full bg-gray-300 dark:bg-gray-700 transition-colors duration-200;
    @apply hover:bg-purple-400 dark:hover:bg-purple-600;
    @apply focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 dark:focus:ring-offset-gray-900;
  }

  .carousel-dot[data-active="true"] {
    @apply bg-purple-500 dark:bg-purple-400;
  }
</style>

